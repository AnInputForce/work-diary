# Docker徒手写个自动发现的部署系统

# 环境准备

参考：在Mac中直接安装Maridb（不推荐），[Mac中MariaDB数据库的安装步骤](http://www.jb51.net/article/93202.htm)

## Docker-Mariadb搭建

参考： [docker（6）：使用dokcer 构建 mariadb 数据库](http://blog.csdn.net/freewebsys/article/details/53540615)

> 使用一个最简单的办法安装了mariadb。并且将数据放到了宿主机的/data/mysql/data 目录下面了。 方便数据备份,数据迁移，同时暴露了3306端口对外。 使用docker还是非常的方便的，比起yum安装配置简单多了。 配置文件也可以通过目录映射的方式修改。 而且完全的拆分了服务，存储，接口。真的是一个集装箱了。

参考：[Start a `mariadb` server instance](https://hub.docker.com/_/mariadb/)，强烈推荐。

### 下载Mariadb数据库镜像

```shell
docker pull mariadb
```

### 启动并配置DB



### 测试验证



## Docker-Django搭建

待补

## Docker开发机配置SSH免密登录

原因：开发机由于使用频繁，每次输入账号登录难免浪费时间。我们改造之。

## 起因：Docker带来的网络的挑战

# 自动发现Docker Server的上线部署系统

## 环境准备

如上所示，已准备好。

## 思路分析

## 开发

# 番外篇：修改无法启动的docker容器的配置

发表于 2016年 10月 11日 济南 作者 [阳光如初.](http://www.veryjava.cn/)

原文地址：[点击这里](http://blog.veryjava.cn/2016/10/11/01/)；**转帖原因**：文章写得太好了，先提前备份下来，有机会测试验证下。

## 问题描述

mysql在运行过程中报错,进入mysql容器修改配置文件时,单词拼错,导致mysql容器无法重新启动.

## 解决思路

由于docker无法进入已经停止的容器,所以只能曲线救国.

- 先提交无法进入的docker容器
- 使用临时终端启动新的镜像并修改相应文件,再次提交改容器
- 将无法启动的docker容器中的内容复制出来
- 使用新的镜像启动容器并挂载文件内容

## 解决步骤

- 提交已经死亡的mysql容器

- ```shell
  bash docker commit mysql-old sunshineasbefore/mysql
  ```

- 启动临时终端并修改出错的配置文件

- ```shell
  bash docker run -it --name mysql-modify sunshineasbefore/mysql /bin/bash
  bash vim /etc/mysql/my.cnf
  ```

- 复制原有mysql数据库

  ```shell
  bash cp -r /data/docker/volumes/925bca0a69b6bffc06933db5578dcadda2efa3d7cee7c5642d7734e001293353 /_data /xxx/xxx
  ```

- 提交修改后的mysql容器

  ```Shell
  bash docker commit mysql-modify sunshineasbefore/mysql
  ```

- 重新启动新的mysql容器并挂载原有mysql数据库

  ```shell
  bash docker run -d -p 3306:3306 --name mysql-new -v /xxx/xxx/_data/:/var/lib/mysql sunshineasbefore/mysql mysqld
  ```

  **这个地方需要注意:** 因为在第二个步骤启动临时终端时使用了`/bin/bash`命令覆盖了mysql镜像中的`mysqld`命令,如果这一步不使用`mysqld` 命令覆盖回来的话,则不会启动成功.

## 总结

- 话说在使用docker的过程中,直接进入容器修改配置文件,出错了好像真没有什么办法能够回复.只能在使用过程中注意了…
- 话说在使用docker的过程中,还是要把配置文件挂载出来的好…